# 2025/10/10 字符串与格式化输入/输出 - 修订版

## 字符串

C语言中没有内置的字符串类型，通常使用字符数组来表示字符串。字符串以双引号声明，如 `"hello"`，双引号不是字符串的一部分。C语言中的字符串以空字符 `'\0'` 作为结束标志，这是一个非打印字符，用于标记字符串的结尾。

例如：
```c
char str[] = "Hello";
```
这个字符串在内存中实际存储为：`'H' 'e' 'l' 'l' 'o' '\0'`。

## 常量和C预处理指令

### #define 预处理指令
在代码开头使用如下形式：
```c
#define PI 3.14159
```
这样的代码被称为C预处理指令，声明的变量PI被称为符号常量。编译器在编译时会将程序中所有`PI`替换为**3.14159**。使用符号常量有利于程序的优化和维护。

### const限定符
`const`关键字用于声明只读变量，限制程序中对变量的修改。const变量必须在声明时初始化：
```c
const int MAX_SIZE = 100;
```

## printf()与scanf()

### printf()函数

`printf()`是C语言的标准输出函数，使用格式化字符串向标准输出设备输出数据。输出数据时需要使⽤与数据类型匹配的**转换说明符**。

#### 常用转换说明符
- `%d` - 有符号十进制整数
- `%f` - 浮点数
- `%c` - 字符
- `%s` - 字符串
- `%p` - 指针地址

#### printf()的转换说明修饰符
可以对输出的数据格式进行更精细的控制，例如：
```c
printf("%10.2f", 3.14159);  // 输出宽度为10，保留2位小数
```

#### 转换说明的意义
转换说明告诉`printf()`如何解释内存中的数据，但不会改变数据的存储方式。

```c
#define NUM1 336
#define NUM2 65618

short num = NUM1;
short mnum = -NUM1;

printf("%hd %hu, %hd %hu", num, num, mnum, mnum);
```
输出结果为：`336 336 -336 65200`

最后一个数据看起来异常是因为：
- 系统采用**二进制补码**表示有符号整数
- 数字0~32767表示本身，32768~65535表示负数（计算方式：65536+X，X为表示的负数）
- 这是转换说明类型不匹配导致的典型问题

#### 大小不匹配的情况
在64位系统中，`short int`占2字节，`char`占1字节。使用`%c`打印336时，计算机只查看存储336的两个字节中的后一个字节，相当于整数除以256取余数。

#### printf()的返回值
`printf()`返回打印的字符总数。如果输出错误，返回负值。

#### 较长字符串的打印
正确的多行字符串写法：
```c
// 方法1：使用连续字符串
printf("abcdefghijklmnopqrstuvwxyz%d.\n", num);

// 方法2：分割字符串字面量
printf("abcdefghijklmnopqrs"
       "tuvwxyz");
```

**错误写法**（不要在双引号内断行）：
```c
// 错误：在双引号内断行
printf("abcdefghijklm
nopqrstuvwxyz");
```

### scanf()函数

#### 基本使用规则
1. 读取基本变量类型时，在变量名前加取地址符（&）：
   ```c
   int age;
   scanf("%d", &age);
   ```

2. 读取字符串时，不需要加&：
   ```c
   char name[20];
   scanf("%s", name);  // name本身就是地址
   ```
   这是因为数组名就是数组首元素的地址。

#### 安全使用建议
为防止缓冲区溢出，建议限制读取长度：
```c
char name[20];
scanf("%19s", name);  // 最多读取19个字符，留1位给'\0'
```

#### scanf()的返回值
返回成功读取的数据项数，可用于检测输入是否成功：
```c
int result = scanf("%d %d", &a, &b);
if (result != 2) {
    printf("输入错误！\n");
}
```

#### *修饰符的用法

1. 在`printf()`中，*用作占位符，在参数中指定输出宽度：
   ```c
   int width = 10;
   int number = 123;
   printf("%*d", width, number);  // 输出宽度为10
   ```

2. 在`scanf()`中，*用于跳过当前输入项：
   ```c
   int day, year;
   scanf("%*s %d %d", &day, &year);  // 跳过第一个字符串
   ```


