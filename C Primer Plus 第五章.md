# C Primer Plus 第五章学习笔记 - 运算符、表达式和语句

## 基本运算符

### 赋值运算符"="

赋值运算符执行的是赋值操作，将右侧的值存储到左侧变量指定的内存位置。

```c
num = 6;        // 将6赋给变量num
total = a + b;  // 将a+b的结果赋给total
```

**左值与右值概念**：
- **可修改的左值**：可出现在赋值运算符左侧，必须满足：
  1. 指定一个可寻址的内存对象
  2. 存储的数据可以被修改
  3. 通常是变量名
  
- **右值**：可出现在赋值运算符右侧，必须有一个特定的值
  - 可以是常量、变量或表达式
  - 一般没有特定的可修改内存空间

**错误示例**：
```c
6 = num;        // 错误：6是常量，不是左值
a + b = 10;     // 错误：a+b是表达式，不是左值
```

**特殊情况说明**：
```c
#define PI 3.14         // PI是符号常量，右值
int num1, num2;         // num1, num2是可修改的左值
num1 + num2;            // 表达式，右值
const int num = 123;    // num是左值（有内存位置），但不可修改
```

### 算术运算符

C语言提供基本的算术运算符：

| 运算符 | 功能 | 示例 |
|--------|------|------|
| `+` | 加法 | `5 + 3 = 8` |
| `-` | 减法 | `5 - 3 = 2` |
| `*` | 乘法 | `5 * 3 = 15` |
| `/` | 除法 | `5 / 3 = 1` |
| `%` | 求模 | `5 % 3 = 2` |

**整数除法的特点**：
```c
printf("%d\n", 5 / 2);      // 输出：2（截断小数部分）
printf("%d\n", -5 / 2);     // 输出：-2（趋零截断）
printf("%d\n", -3.8 / 2);   // 输出：-1（浮点数转整数后计算）
```

**浮点数除法**：
```c
printf("%f\n", 5.0 / 2);    // 输出：2.500000
printf("%f\n", 5 / 2.0);    // 输出：2.500000
printf("%f\n", (float)5 / 2); // 输出：2.500000
```

### 符号运算符"+/-"

用于表示数值的正负：
```c
int positive = +5;      // 正数（通常省略+号）
int negative = -5;      // 负数
int result = -positive; // -5
```

### 复合赋值运算符

将算术运算与赋值结合，提高代码简洁性：

| 运算符 | 等价形式 | 示例 |
|--------|----------|------|
| `+=` | `a = a + b` | `a += 5` |
| `-=` | `a = a - b` | `a -= 3` |
| `*=` | `a = a * b` | `a *= 2` |
| `/=` | `a = a / b` | `a /= 4` |
| `%=` | `a = a % b` | `a %= 3` |

**使用示例**：
```c
int count = 10;
count += 5;     // count = 15
count *= 2;     // count = 30
count /= 3;     // count = 10
```

### 求模运算符"%"

专门用于整数运算，返回除法余数：

```c
printf("%d\n", 11 % 5);     // 输出：1
printf("%d\n", 11 % -5);    // 输出：1
printf("%d\n", -11 % 5);    // 输出：-1
printf("%d\n", -11 % -5);   // 输出：-1
```

**求模运算规则**：
- 结果的符号与第一个操作数相同
- 只能用于整数类型

### 递增递减运算符"++"/"--"

**前缀与后缀的区别**：

```c
int a = 5, b = 5;
int prefix = ++a;   // a先增加到6，然后赋值给prefix
int postfix = b++;  // b的当前值5赋值给postfix，然后b增加到6

printf("prefix = %d, a = %d\n", prefix, a);    // prefix = 6, a = 6
printf("postfix = %d, b = %d\n", postfix, b);  // postfix = 5, b = 6
```

**复杂表达式中的使用**：
```c
int x = 3, y = 3;
int result1 = x++ + ++x;    // 避免这种用法：未定义行为
int result2 = ++y + y++;    // 避免这种用法：未定义行为
```

### sizeof运算符

返回类型或对象的大小（字节数）：

```c
int num = 10;
printf("int size: %zu\n", sizeof(int));        // 输出int类型大小
printf("num size: %zu\n", sizeof(num));        // 输出变量大小
printf("literal size: %zu\n", sizeof(3.14));   // 输出字面量大小
```

**size_t类型**：
- `sizeof`返回`size_t`类型，是无符号整数类型
- 格式化输出使用`%zu`

## 运算符优先级

从高到低的主要优先级（完整表格参考教材P94-P96）：

1. `()` 圆括号
2. `++` `--` `+` `-` `!` `(type)` `sizeof` （后缀高于前缀）
3. `*` `/` `%`
4. `+` `-`
5. `<` `<=` `>` `>=`
6. `==` `!=`
7. `=` `+=` `-=` `*=` `/=` `%=`

**优先级示例**：
```c
int result = 5 + 3 * 2;     // 11，不是16（乘法优先级高于加法）
int complex = (5 + 3) * 2;  // 16，圆括号改变优先级
```

## 表达式与语句

### 表达式

表达式由运算符和运算对象组成，每个表达式都有一个值：

```c
5               // 值为5的表达式
a + b           // 值为a+b的表达式
x = 5           // 值为5的表达式（赋值表达式的值就是被赋的值）
```

### 语句

C语言中，语句是程序执行的基本单位：

```c
;                       // 空语句
num = 5;                // 表达式语句
printf("Hello\n");      // 函数调用语句
{ /* 代码块 */ }         // 复合语句
```

**表达式与语句的关系**：
- 语句 = 表达式 + 分号
- 但不是所有语句都是表达式（如控制语句）

### 副作用与序列点

**副作用**：对数据对象或文件的修改
```c
x = 5;      // 副作用：改变x的值
x++;        // 副作用：改变x的值
```

**序列点**：程序执行中的特定点，在此点之前的所有副作用都必须完成
- 语句结束（分号）
- `&&`、`||`、`?:`和逗号运算符
- 函数调用中所有参数求值完成后

## 类型转换

### 隐式类型转换

编译器自动进行的类型转换：

**整型提升**：
```c
char c = 'A';
int i = c + 5;      // char自动提升为int
```

**算术转换**（类型升级）：
```c
int i = 5;
float f = 3.14;
double result = i + f;  // i转换为float，然后转换为double
```

**常用类型等级**（从低到高）：
`char` → `short` → `int` → `unsigned` → `long` → `unsigned long` → `float` → `double` → `long double`

### 显式类型转换（强制类型转换）

程序员明确指定的类型转换：

```c
int total = 10, count = 4;
double average;

// 错误：整数除法
average = total / count;          // 结果为2.0

// 正确：强制类型转换
average = (double)total / count;  // 结果为2.5

// 另一种写法
average = total / (double)count;  // 结果为2.5
```

**强制类型转换语法**：
```c
(type)expression
```

**更多示例**：
```c
float f = 3.14;
int i = (int)f;         // i = 3（截断小数部分）

double d = 123.456;
long l = (long)d;       // l = 123
```

## 编程注意事项

### 1. 避免未定义行为

**错误示例**：
```c
int i = 1;
int j = i++ + i++;      // 未定义行为：同一表达式多次修改同一变量

int arr[5];
int index = 0;
arr[index] = index++;    // 未定义行为：赋值左右两侧都使用index
```

**正确做法**：
```c
int i = 1;
int j = i + 1;          // 明确计算
i += 2;

int arr[5];
int index = 0;
arr[index] = value;     // 先使用
index++;                // 后递增
```

### 2. 注意整数除法

**常见错误**：
```c
int total = 7, count = 2;
double average = total / count;  // 错误：结果为3.0而不是3.5
```

**正确做法**：
```c
double average = (double)total / count;  // 正确：3.5
// 或
double average = total / (double)count;  // 正确：3.5
// 或
double average = total / 2.0;            // 正确：3.5
```

### 3. 运算符优先级陷阱

**容易出错的表达式**：
```c
int a = 5, b = 3, c = 2;
int result = a + b * c;     // 11，不是16
int flag = a & 1 == 0;      // 0，不是预期结果（==优先级高于&）
```

**使用圆括号明确意图**：
```c
int result = a + (b * c);   // 明确表达意图
int flag = (a & 1) == 0;    // 明确表达意图
```

### 4. 递增递减运算符的最佳实践

**推荐做法**：
```c
int i = 0;
// 单独使用
i++;            // 清晰明了

// 在循环中使用
for (int j = 0; j < 10; j++) {
    // 循环体
}

// 避免在复杂表达式中混合使用
int a = 5;
int b = a++;    // 明确：b=5, a=6
```

